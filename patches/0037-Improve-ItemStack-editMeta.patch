From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: LemonCaramel <admin@caramel.moe>
Date: Thu, 7 Oct 2021 02:46:43 +0900
Subject: [PATCH] Improve ItemStack#editMeta


diff --git a/src/main/java/org/bukkit/inventory/ItemStack.java b/src/main/java/org/bukkit/inventory/ItemStack.java
index 0dcd6597c8ae796a5b258ad2776407e9445d9034..76edaa04d4960b6bd54805cefa42beb49b01c07a 100644
--- a/src/main/java/org/bukkit/inventory/ItemStack.java
+++ b/src/main/java/org/bukkit/inventory/ItemStack.java
@@ -557,9 +557,28 @@ public class ItemStack implements Cloneable, ConfigurationSerializable, net.kyor
      * @return {@code true} if the edit was successful, {@code false} otherwise
      */
     public boolean editMeta(final @NotNull java.util.function.Consumer<? super ItemMeta> consumer) {
-        final ItemMeta meta = this.getItemMeta();
-        if (meta != null) {
-            consumer.accept(meta);
+        return editMeta(ItemMeta.class, consumer);
+    }
+
+    /**
+     * Edits the {@link ItemMeta} of this stack if the meta is of the specified type.
+     * <p>
+     * The {@link java.util.function.Consumer} must only interact
+     * with this stack's {@link ItemMeta} through the provided {@link ItemMeta} instance.
+     * Calling this method or any other meta-related method of the {@link ItemStack} class
+     * (such as {@link #getItemMeta()}, {@link #addItemFlags(ItemFlag...)}, {@link #lore()}, etc.)
+     * from inside the consumer is disallowed and will produce undefined results or exceptions.
+     * </p>
+     *
+     * @param metaClass the type of meta to edit
+     * @param consumer the meta consumer
+     * @param <M> the meta type
+     * @return {@code true} if the edit was successful, {@code false} otherwise
+     */
+    public <M extends ItemMeta> boolean editMeta(final @NotNull Class<M> metaClass, final @NotNull java.util.function.Consumer<? super M> consumer) {
+        final @Nullable ItemMeta meta = this.getItemMeta();
+        if (metaClass.isInstance(meta)) {
+            consumer.accept((M) meta);
             this.setItemMeta(meta);
             return true;
         }
